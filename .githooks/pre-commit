#!/bin/bash
# Pre-commit hook: goimports formatting check + go vet

set -e

STAGED_GO_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$' || true)

if [[ -z "$STAGED_GO_FILES" ]]; then
  exit 0
fi

echo "Running goimports..."
UNFORMATTED=$(echo "$STAGED_GO_FILES" | xargs goimports -l 2>/dev/null || true)
if [[ -n "$UNFORMATTED" ]]; then
  echo "Files need formatting (run 'goimports -w' on these):"
  echo "$UNFORMATTED"
  exit 1
fi

echo "Running go vet..."
go vet ./...

echo "Pre-commit checks passed."
